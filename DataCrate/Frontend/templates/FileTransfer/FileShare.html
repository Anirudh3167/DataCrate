{% load static %}
<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title> DataCrate </title>
    <link rel="stylesheet" href="{% static 'css/FileTransfer/FileShare.css' %}">
</head>
<body>
    {% include 'Components/HorizontalNavBar.html' %}
    <div class="FileShareWrapper">
        <!-- Main Container of the upload -->
        <div class="FileShareContainer">
            <!-- File Upload -->
            <div class="FileUploadWrapper">
                <div class="FileUploadHead"> File Upload </div>
                <!-- For The initial upload of files -->
                <div class="FileUploadContainer" id="uploadBox" ondragover="handleDragOver(event)" 
                ondragleave="handleDragLeave(event)" ondrop="handleDrop(event)">
                    <!-- Handles the initial File uploading -->
                    <div class="FileUploadSlide" id="FileUploadSlide1">
                        <div class="FileUploadText"> 
                            Icon of Upload here.
                            <br><br><br>
                            Drag and drop here 
                            <br><br><br>
                            -- or --
                        </div>
                        <input type="file" multiple id="file-upload-input" name="file-upload-input"
                        oninput="showInput(event)" hidden>
                        <button onClick="getFileInput()" class="FileUploadBtn" id="FileUploadBtn"> 
                            Select Files to Upload 
                        </button>
                    </div>
                    <!-- Handles the upload along with displaying files -->
                    <div class="FileUploadSlide" id="FileUploadSlide2" style="display: none;">
                        <div class="FileUploadShowFiles">
                            <div class="FileUploadFile"> 
                                Some File here 
                                <div class="FileUploadDeleteFile"> Del </div>
                            </div>
                        </div>
                        <div class="FileUploadLink" id="FileUploadLink" onclick="getFileInput()"> Choose other files </div>
                        <a href="{% url 'BasicSite:Home' %}" class="FileUploadBtn" style="text-decoration: none;"> 
                            Generate Link 
                        </a>
                        <button class="FileUploadBtn" onclick="resetDisplay()" style="background-color: red;"> 
                            Cancel File Upload
                        </button>

                    </div>
                    <!-- For Handling the link display -->
                    <!--  -->

                    <!-- Copy Link, Share Link,... -->
                </div>
            </div>
            <!-- File Download -->
            <div class="FileDownloadWrapper">
                <div class="FileUploadHead"> File Download </div>
                <!-- Slide 1 : Ask the link/code -->
                <div class="FileDownloadSlide" id="FileDownloadSlide1">
                    <div class="FileDownloadText"> Enter the link or code :</div>
                    <div class="FileDownloadLinkBox">
                        <input type="text" value="http://127.0.0.1:8000/file-transfer/" readonly style="text-align: right;">
                        <input type="text" id="download-code" placeholder="Your Code" oninput="fileDownloadInputHandle()">
                    </div>
                    <div class="DownloadLinkBtn" onclick="getFiles()"> Get Files </div>
                </div>
                <!-- Slide 2 : Show the download options -->
                <div class="FileDownloadSlide" id="FileDownloadSlide2" style="display: none;height: 450px;align-items: flex-start;">
                    <div class="FileUploadShowFiles" style="height: 100%;">
                        <div class="FileUploadFile"> 
                            Some File here 
                            <div class="FileUploadDeleteFile"> Download </div>
                        </div>
                    </div>
                    <div class="FileDownloadFileInfo">
                        <div class="FileDownloadFileCount"> 2 files in total </div>
                        <div class="FileDownlodBtns">
                            <div class="FileDownloadBtn"> Download All </div>
                            <div class="FileDownloadBtn" style="background-color: red;" onclick="resetDownload()"> Cancel </div>
                        </div>
                    </div>
                </div>
            </div>
            <!-- Others: Handles if the link is of the Editor -->
            <div class="FileDownloadEditorContainer">
                <!-- Any Editor related thing will appear here. -->
                <textarea  class="FileDownloadEditor" name="file-download-editor" id="file-download-editor" readonly>
                </textarea>
                <div class="FileDownloadEditorBtns">
                    <div class="EditorBtn" onclick="getEditorContent()"> Get Editor Content </div>
                    <a href="{% url 'Editor:Editor' %}" class="EditorBtn"> Continue Editing </a>
                </div>
            </div>
        </div>
    </div>
    <script>
        //////////////////////////////////
        // File Upload Script
        //////////////////////////////////
        const dropArea = document.getElementById("uploadBox");
        const fileInput = document.getElementById('file-upload-input');
        const uploadBtn = document.getElementById('FileUploadBtn');
        const slide_1_1 = document.getElementById('FileUploadSlide1');
        const slide_1_2 = document.getElementById('FileUploadSlide2');
        const fileDisplay = document.getElementsByClassName('FileUploadShowFiles')[0]
        
        function getFileInput() {fileInput.click();}
        function preventDefault(e) {e.preventDefault();}
        function updateFilesList() {
            let files = fileInput.files;
            let content = ""
            for(let i = 0; i < files.length; i++) {
                content += ` <div class="FileUploadFile"> 
                                ${files[i].name.length > 20 ? files[i].name.slice(0,50) + "..." : files[i].name}
                                <div class="FileUploadDeleteFile"> Del </div>
                            </div>`;
            }
            fileDisplay.innerHTML = content;
        }
        function showInput(e) {
            if (fileInput.files.length === 0) return ;
            updateFilesList();
            uploadBtn.style.display = "none";
            // fileInput.style.display = "flex";
            slide_1_1.style.display = "none";
            slide_1_2.style.display = "flex";
        }

        function resetDisplay() {
            slide_1_2.style.display = "none";
            slide_1_1.style.display = "flex";
            uploadBtn.style.display = "flex";
            fileInput.style.display = "none";

        }
        function handleDragOver(e) {
            e.preventDefault();
            e.stopPropagation();
            dropArea.classList.add('dragover');
        }

        function handleDragLeave(e) {
            e.preventDefault();
            e.stopPropagation();
            dropArea.classList.remove('dragover');
        }

        function handleDrop(e) {
            e.preventDefault();
            e.stopPropagation();
            dropArea.classList.remove('dragover');
            const files = e.dataTransfer.files;
            fileInput.files = files;

            showInput();
        }
    </script>
    <script>
        //////////////////////////////////
        // File Download Script
        //////////////////////////////////
        let downloadCode = "";
        const codeInp = document.getElementById('download-code');
        const slide_2_1 = document.getElementById('FileDownloadSlide1');
        const slide_2_2 = document.getElementById('FileDownloadSlide2');
        const editor = document.getElementById('file-download-editor');

        function fileDownloadInputHandle() {
            downloadCode = codeInp.value.split('http://127.0.0.1:8000/file-transfer')[0];
            console.log(downloadCode);
        }
        function getFiles() {
            slide_2_1.style.display = "none";
            slide_2_2.style.display = "flex";
            console.log(`Files are requested for link : http://127.0.0.1:8000/file-transfer/${downloadCode}`);
        }
        function resetDownload() {
            slide_2_1.style.display = "flex";
            slide_2_2.style.display = "none";
        }
        function getEditorContent() {
            content = `
                def HelloWorld():
                    return "Hello word"
                
                def main():
                    print(HelloWorld())

                main()`;
            console.log(content);
            editor.innerText = content;
        }
    </script>
</body>
</html>